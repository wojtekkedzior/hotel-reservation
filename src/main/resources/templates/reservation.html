<html xmlns:th="http://www.thymeleaf.org">


<head>
<title>Getting Started: Serving Web Content</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" href="/hotelreservation/css/mycss.css" />
</head>

<body>


	<form action="#" th:action="@{/reservation}" th:object="${reservation}"
		method="post">

		<p>
			Start Date: <input id="desiredReservationStartDate" type="date"
				name="startDate" th:value="2018-03-09"
				th:onClick="'javascript:changedDate();'" /> End Date: <input
				id="desiredReservationEndDate" type="date" name="endDate"
				th:value="2018-03-20" th:onClick="'javascript:changedDate();'" /> <a
				th:id="filterByDate" th:onClick="'javascript:changedDate();'"
				th:text="Filter"> </a>
			<!-- add OnLoad -->
		</p>

		<div th:each="roomRateCombo : ${roomRatesPerRoom}">
			<p>
				Room Number: <label
					th:text="${roomRateCombo.key.roomNumber} + ' - ' + ${roomRateCombo.key.description}"></label>
			</p>

			<p>
				<select name="wgtmsr" class="form-control" multiple="multiple"
					th:id="'roomRateSelect-' + ${roomRateCombo.key.roomNumber}"
					size="12" th:field="${reservation.roomRates}"
					th:onChange="'javascript:subTotal(\'' + ${roomRateCombo.key.roomNumber} + '\');'">
					<!-- onChange="showLimits()" -->

					<!-- It's odd having the option value set to roomRate.id and the id to roomRate.value, but if the ID is not set than the roomRates are not added to the reservation  -->
					<option th:each="roomRate : ${roomRateCombo.value}"
						th:value="${roomRate.id}" th:id="${roomRate.value}"
						th:text="${roomRate.day} + ' - ' + ${roomRate.value} + ' - ' + ${roomRate.room.description}"
						th:onClick="'javascript:sayHello(\'' + ${roomRate.value} + '\');'"></option>
				</select>
			</p>

			<p>
				Sub Total: <input
					th:id="'roomRateSelectSubTotal-' + ${roomRateCombo.key.roomNumber}"
					type="number" />
			</p>
		</div>

		<p>
			<!-- hidden field to make sure the ID gets passed back to the controller when submit is called. -->
			<input type="number" th:field="${reservation.id}" hidden="true" /> <input
				type="date" th:field="${startDate}" th:value="2008-03-09"
				hidden="true" /> Guest First Name: <input type="text"
				th:field="${reservation.mainGuest.firstName}" /> Guest Last Name: <input
				type="text" th:field="${reservation.mainGuest.lastName}" />
		</p>

		<p>
			<input type="submit" value="Submit" />
		</p>

	</form>

	<div>
		<table width="1000">
			<tr>
				<td><label>Id</label></td>
				<td><label>First Name</label></td>
				<td><label>Last Name</label></td>
				<td><label>Start Date</label></td>
				<td><label>End Date</label></td>
				<td><label>Created By</label></td>
				<td><label>Created On</label></td>
		<!-- 		<td><label>Realise</label></td> -->
				<td><label>Cancel</label></td>
			</tr>

			<tr th:each="reservation, iterstat: ${reservations}">
				<td><a th:href="@{/reservation/}+${reservation.id}"
					th:text="${reservation.id}"> </a></td>
				<td th:text="${reservation.mainGuest.firstName}"></td>
				<td th:text="${reservation.mainGuest.lastName}"></td>
				<td th:text="${reservation.startDate}"></td>
				<td th:text="${reservation.endDate}"></td>
				<td th:text="${reservation.createdOn}"></td>
				<td th:text="${reservation.createdBy}"></td>
<!-- 				<td>
					<form action="#" th:action="@{/realiseReservation/}+${reservation.id}"
						th:method="get">
						<input type="hidden" name="_method" value="get" />
						<button type="submit">Realise</button>
					</form>
				</td> -->
				<td>
					<form action="#" th:action="@{/reservationDelete/}+${reservation.id}"
						th:method="delete">
						<input type="hidden" name="_method" value="delete" />
						<button type="submit">delete</button>
					</form>
				</td>
			</tr>
		</table>
	</div>

</body>

<script th:inline="javascript">
	/*<![CDATA[*/
	function sayHello(value) {
		var currentTotal = document.getElementById("total").value;
		document.getElementById("total").value = +currentTotal + +value;
	}

	function subTotal(value) {
		var select = document.getElementById("roomRateSelect-" + value);
		var subTotal = 0;

		for (i = 0; i < select.length; i++) {
			if (select[i].selected) {
				subTotal = subTotal + +select[i].id;
			}
		}

		document.getElementById("roomRateSelectSubTotal-" + value).value = subTotal;
	}

	function changedDate() {
		var startDate = document.getElementById("desiredReservationStartDate");
		var endDate = document.getElementById("desiredReservationEndDate");

		document.getElementById("filterByDate").href = "/hotelreservation/reservation/start/"
				+ startDate.value + "/end/" + endDate.value;
	}

	/*]]>*/
</script>

</html>